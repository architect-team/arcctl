version: v2

databases:
  main:
    type: postgres:13

builds:
  main:
    context: ./

deployments:
  main:
    image: ${{ builds.main.image }}
    environment:
      DB_ADDR: ${{ databases.main.dsn }}

services:
  main:
    deployment: main
    port: 8080

ingresses:
  service:
    service: main