state:
  type: local
  path: /Users/davidthor/Workspaces/arc-v2/cldctl/.terraform

resources:
  vpc:
    type: vpc
    name: test-env
    provider: do-personal
    region: nyc1
  cluster:
    type: kubernetesCluster
    provider: do-personal
    name: test-env
    kubernetesVersion: 1.24.12-do.0
    region: nyc1
    vpc: ${{ resources.vpc.id }}
    nodePools:
      - name: pool1
        count: 3
        nodeSize: s-1vcpu-2gb
  namespace:
    type: kubernetesNamespace
    provider: ${{ resources.cluster.provider }}
    name: test-env
  nginx-ingress-controller:
    type: helmChart
    name: ingress-nginx
    provider: ${{ resources.cluster.provider }}
    namespace: ${{ resources.namespace.id }}
    repository: https://kubernetes.github.io/ingress-nginx
    chart: ingress-nginx

hooks:
  - when:
      type: databaseSchema
      databaseType: postgres
    resources:
      db:
        type: database
        provider: do-personal
        name: ${{ this.inputs.name }}
        databaseVersion: ${{ this.inputs.databaseVersion }}
        databaseSize: db-s-1vcpu-1gb
        databaseType: ${{ this.inputs.databaseType }}
        vpc: ${{ resources.vpc.id }}
        region: nyc1
    provider: ${{ this.resources.db.provider }}
    database: ${{ this.resources.db.id }}
  - when:
      type: ingressRule
    resources:
      dnsRecord:
        type: dnsRecord
        provider: do-personal
        dnsZone: ${{ this.inputs.listener.hostZone }}
        subdomain: ${{ this.inputs.listener.subdomain }}
        recordType: A
        content: ${{ this.outputs.host }}
    loadBalancer: nginx
    namespace: ${{ resources.namespace.id }}
  - provider: ${{ resources.cluster.provider }}
    namespace: ${{ resources.namespace.id }}